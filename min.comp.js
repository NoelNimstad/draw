const createCanvas=(e,t)=>{const n=document.createElement("canvas");return n.width=e,n.height=t,document.body.append(n),n},canvas=createCanvas(window.innerWidth,window.innerHeight),previewCanvas=createCanvas(window.innerWidth,window.innerHeight);previewCanvas.classList.add("preview");const context=canvas.getContext("2d"),previewContext=previewCanvas.getContext("2d");let lines=[],cl=0,paths=[];const setLineWidth=e=>{context.lineWidth=e,previewContext.lineWidth=e},setStrokeStyle=e=>{context.strokeStyle=e,previewContext.strokeStyle=e};setLineWidth(3),setStrokeStyle("#000"),context.lineCap="round";let drawing=!1,x=0,y=0,line=!1;function undo(){const e=lines.pop();paths.splice(-e);let t=context.strokeStyle;redraw(),context.strokeStyle=t}function redraw(){context.clearRect(0,0,canvas.width,canvas.height);for(let e of paths)setStrokeStyle(e.c),setLineWidth(e.w),context.beginPath(),context.moveTo(e.x,e.y),context.lineTo(e.ex,e.ey),context.stroke()}canvas.addEventListener("mousedown",(e=>{drawing=!0,e.shiftKey&&(line=!0),cl=0,[x,y]=[e.x,e.y]})),canvas.addEventListener("mouseup",(e=>{drawing=!1,line&&(previewContext.clearRect(0,0,window.innerWidth,window.innerHeight),context.beginPath(),context.moveTo(x,y),context.lineTo(e.x,e.y),context.stroke(),line=!1,cl=1,paths.push({x:x,y:y,ex:e.x,ey:e.y,c:context.strokeStyle,w:context.lineWidth})),lines.push(cl)})),canvas.addEventListener("mousemove",(e=>{if(drawing){if(cl++,line)return previewContext.clearRect(0,0,window.innerWidth,window.innerHeight),previewContext.beginPath(),previewContext.moveTo(x,y),previewContext.lineTo(e.x,e.y),void previewContext.stroke();context.beginPath(),context.moveTo(x,y),context.lineTo(e.x,e.y),context.stroke(),paths.push({x:x,y:y,ex:e.x,ey:e.y,c:context.strokeStyle,w:context.lineWidth}),[x,y]=[e.x,e.y]}}));let editing=!1,fontSize=1;function screenshot(){previewContext.fillStyle="#fff",previewContext.fillRect(0,0,window.innerWidth,window.innerHeight),previewContext.fillStyle="#000",previewContext.drawImage(canvas,0,0),previewContext.font=16*fontSize+"px sans-serif";const e=document.getElementsByTagName("p");for(let t of e){const e=t.getBoundingClientRect();previewContext.fillText(t.innerText,parseInt(t.style.left),parseInt(t.style.top)+.817*e.height)}const t=document.createElement("a");t.href=previewCanvas.toDataURL(),t.target="_blank",document.body.append(t),t.click(),t.remove(),previewContext.clearRect(0,0,window.innerWidth,window.innerHeight)}document.addEventListener("keydown",(e=>{switch(e.key){case"ArrowUp":fontSize+=.1,document.body.style.fontSize=fontSize+"rem";break;case"ArrowDown":fontSize-=.1,document.body.style.fontSize=fontSize+"rem";break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":setLineWidth(parseInt(e.key));break;case"r":setStrokeStyle("#f00");break;case"g":setStrokeStyle("#0f0");break;case"b":setStrokeStyle("#00f");break;case"s":setStrokeStyle("#000");break;case"q":setStrokeStyle("#aaa");break;case"y":setStrokeStyle("#fff200");break;case"T":const t=document.createElement("p");t.contentEditable=!0,t.draggable=!0,document.body.append(t),t.innerText="text",t.style.top=window.innerHeight/2+"px",t.style.left=window.innerWidth/2+"px";let n,i,o=!1;t.addEventListener("mousedown",(e=>{if(e.shiftKey){e.preventDefault(),o=!0;let a=t.getBoundingClientRect();n=a.width/2,i=a.height/2}})),t.addEventListener("focus",(()=>editing=!0)),t.addEventListener("blur",(()=>editing=!1)),t.addEventListener("mouseup",(()=>o=!1)),t.addEventListener("keydown",(e=>{"Escape"==e.key&&(editing=!1,t.blur())})),document.addEventListener("mousemove",(e=>{e.preventDefault(),o&&(t.style.top=e.y-i+"px",t.style.left=e.x-n+"px")}));break;case"Z":undo()}}));